# Архитектура интерпретатора

![Архитектура](./images/architecture.png)


### **Controller**

-   **Точка входа**:
    
    -   `run()`: Бесконечный цикл:
        
        1.  Чтение ввода пользователя.
            
        2.  **Парсинг**  через  `Parser.parse()`.
            
        3.  **Исполнение**  через  `Executor.execute()`.
            
    -   **Завершение**: При получении команды  `exit`  → прерывание цикла.
        

----------

### **Parser**

-   **Этапы парсинга**:

    1.  **Обработка каждой подкоманды**:
                
        -   Токенизация через  `shlex.split()`

    -   **Результат**:  `ParsedCommands`, где каждый `ParsedCommand` — команда с аргументами.


----------

### **Executor**

-   **Создание команд**:
    
    -   **Встроенные команды**  (cat, echo, wc, pwd, exit и другие):
        
        -   `CommandStorage` возвращает объекты классов, реализующих  `Command`  (например,  `EchoCommand(args)`).
            
    -   **Внешние команды**:
        
        -   `DefaultCommand`: создается отдельный процесс через subprocess.
            
----------

### **Ключевые детали**

-   **Объектное представление**: Результат парсинга — `ParsedCommands`, состоящая из списка `ParsedCommand` - названий команд и их аргументов.
    
-   **Внешние процессы**:
    
    -   `DefaultCommand`  запускает процесс "как есть" (например,  `git status`  → напрямую через ОС).
        
-   **Обработка ошибок**:
    
    -   Несуществующие файлы → вывод сообщения в  `stderr`.
        
    -   Некорректный синтаксис → ошибка парсинга.
        
-   **Завершение работы**:
    
    -   При получении `ExitException` в контроллере завершение работы интерпретатора.

----------

### **Процесс работы системы.**

**В цикле:**

1. **Controller**  считывает введенную пользовтелем команду и запускает обработку.
    
2.  **Парсер**  разбирает строку:

    -   Разбивает на аргументы с помощью библиотеки `shlex` 
        
3.  **Controller**  передает команду  **Executor**.
    
4.  **Executor**  выполняет команду:

    - Для каждой команды из последовательности:

        - С помощью `_command_storage.get_command()` получает обработчик, реализующий интерфейс `Command`

        - У этого обработчика вызывается метод `execute`
        
            -   Если это встроенная команда (например,  `echo`) → вызывает соответствующий обработчик.

            - Если это `exit`  →  выкидывается исключение `ExitException`, которое ловит `Controller` и завершает программу.
                
            -   Если это внешняя команда (например,  `git`) → запускает ее как отдельный процесс.
        
        - Результат метода `execute` - код возврата.
